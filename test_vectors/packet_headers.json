{
  "description": "Reticulum v1.1.3 reference implementation - packet header test vectors",
  "source": "RNS/Packet.py",
  "constants": {
    "mtu_bytes": 500,
    "header_1_size_bytes": 19,
    "header_2_size_bytes": 35,
    "truncated_hash_length_bytes": 16,
    "max_data_unit_bytes": 462
  },
  "flag_byte_layout": {
    "description": "Single byte encoding packet metadata",
    "bits": "HH_C_T_DD_PP",
    "bit_fields": {
      "header_type": {
        "bits": "7-6",
        "mask": "0b01000000",
        "shift": 6,
        "note": "Bit 7 unused/reserved"
      },
      "context_flag": {
        "bits": "5",
        "mask": "0b00100000",
        "shift": 5
      },
      "transport_type": {
        "bits": "4",
        "mask": "0b00010000",
        "shift": 4
      },
      "destination_type": {
        "bits": "3-2",
        "mask": "0b00001100",
        "shift": 2
      },
      "packet_type": {
        "bits": "1-0",
        "mask": "0b00000011",
        "shift": 0
      }
    },
    "packing_formula": "(header_type << 6) | (context_flag << 5) | (transport_type << 4) | (dest_type << 2) | packet_type"
  },
  "packet_type_values": {
    "DATA": 0,
    "ANNOUNCE": 1,
    "LINKREQUEST": 2,
    "PROOF": 3
  },
  "destination_type_values": {
    "SINGLE": 0,
    "GROUP": 1,
    "PLAIN": 2,
    "LINK": 3
  },
  "header_type_values": {
    "HEADER_1": 0,
    "HEADER_2": 1
  },
  "transport_type_values": {
    "BROADCAST": 0,
    "TRANSPORT": 1
  },
  "header_1_layout": {
    "description": "Standard header: flags(1) + hops(1) + dest_hash(16) + context(1) = 19 bytes",
    "fields": [
      {
        "name": "flags",
        "offset": 0,
        "length": 1
      },
      {
        "name": "hops",
        "offset": 1,
        "length": 1
      },
      {
        "name": "destination_hash",
        "offset": 2,
        "length": 16
      },
      {
        "name": "context",
        "offset": 18,
        "length": 1
      }
    ]
  },
  "header_2_layout": {
    "description": "Transport header: flags(1) + hops(1) + transport_id(16) + dest_hash(16) + context(1) = 35 bytes",
    "fields": [
      {
        "name": "flags",
        "offset": 0,
        "length": 1
      },
      {
        "name": "hops",
        "offset": 1,
        "length": 1
      },
      {
        "name": "transport_id",
        "offset": 2,
        "length": 16
      },
      {
        "name": "destination_hash",
        "offset": 18,
        "length": 16
      },
      {
        "name": "context",
        "offset": 34,
        "length": 1
      }
    ]
  },
  "packet_hash_algorithm": {
    "description": "Packet hash = SHA-256(hashable_part)[:16]",
    "hashable_part_header_1": "bytes([raw[0] & 0x0F]) + raw[2:]",
    "hashable_part_header_2": "bytes([raw[0] & 0x0F]) + raw[TRUNCATED_HASHLENGTH_BYTES + 2:]",
    "note": "Masking raw[0] with 0x0F strips header_type, context_flag, and transport_type, keeping only dest_type + packet_type"
  },
  "flag_packing_vectors": [
    {
      "description": "HEADER_1 | no_context | BROADCAST | SINGLE | DATA",
      "header_type": 0,
      "context_flag": 0,
      "transport_type": 0,
      "destination_type": 0,
      "packet_type": 0,
      "flags_byte": "00",
      "flags_binary": "00000000"
    },
    {
      "description": "HEADER_1 | no_context | BROADCAST | SINGLE | ANNOUNCE",
      "header_type": 0,
      "context_flag": 0,
      "transport_type": 0,
      "destination_type": 0,
      "packet_type": 1,
      "flags_byte": "01",
      "flags_binary": "00000001"
    },
    {
      "description": "HEADER_1 | no_context | BROADCAST | SINGLE | LINKREQUEST",
      "header_type": 0,
      "context_flag": 0,
      "transport_type": 0,
      "destination_type": 0,
      "packet_type": 2,
      "flags_byte": "02",
      "flags_binary": "00000010"
    },
    {
      "description": "HEADER_1 | no_context | BROADCAST | SINGLE | PROOF",
      "header_type": 0,
      "context_flag": 0,
      "transport_type": 0,
      "destination_type": 0,
      "packet_type": 3,
      "flags_byte": "03",
      "flags_binary": "00000011"
    },
    {
      "description": "HEADER_1 | no_context | BROADCAST | GROUP | DATA",
      "header_type": 0,
      "context_flag": 0,
      "transport_type": 0,
      "destination_type": 1,
      "packet_type": 0,
      "flags_byte": "04",
      "flags_binary": "00000100"
    },
    {
      "description": "HEADER_1 | no_context | BROADCAST | PLAIN | DATA",
      "header_type": 0,
      "context_flag": 0,
      "transport_type": 0,
      "destination_type": 2,
      "packet_type": 0,
      "flags_byte": "08",
      "flags_binary": "00001000"
    },
    {
      "description": "HEADER_1 | no_context | BROADCAST | LINK | DATA",
      "header_type": 0,
      "context_flag": 0,
      "transport_type": 0,
      "destination_type": 3,
      "packet_type": 0,
      "flags_byte": "0c",
      "flags_binary": "00001100"
    },
    {
      "description": "HEADER_1 | context_set | BROADCAST | SINGLE | DATA",
      "header_type": 0,
      "context_flag": 1,
      "transport_type": 0,
      "destination_type": 0,
      "packet_type": 0,
      "flags_byte": "20",
      "flags_binary": "00100000"
    },
    {
      "description": "HEADER_1 | no_context | TRANSPORT | SINGLE | DATA",
      "header_type": 0,
      "context_flag": 0,
      "transport_type": 1,
      "destination_type": 0,
      "packet_type": 0,
      "flags_byte": "10",
      "flags_binary": "00010000"
    },
    {
      "description": "HEADER_2 | no_context | TRANSPORT | SINGLE | DATA",
      "header_type": 1,
      "context_flag": 0,
      "transport_type": 1,
      "destination_type": 0,
      "packet_type": 0,
      "flags_byte": "50",
      "flags_binary": "01010000"
    },
    {
      "description": "HEADER_2 | no_context | TRANSPORT | SINGLE | ANNOUNCE",
      "header_type": 1,
      "context_flag": 0,
      "transport_type": 1,
      "destination_type": 0,
      "packet_type": 1,
      "flags_byte": "51",
      "flags_binary": "01010001"
    },
    {
      "description": "HEADER_2 | context_set | TRANSPORT | LINK | PROOF",
      "header_type": 1,
      "context_flag": 1,
      "transport_type": 1,
      "destination_type": 3,
      "packet_type": 3,
      "flags_byte": "7f",
      "flags_binary": "01111111"
    }
  ],
  "flag_unpacking_vectors": [
    {
      "flags_byte": "00",
      "flags_binary": "00000000",
      "header_type": 0,
      "context_flag": 0,
      "transport_type": 0,
      "destination_type": 0,
      "packet_type": 0
    },
    {
      "flags_byte": "01",
      "flags_binary": "00000001",
      "header_type": 0,
      "context_flag": 0,
      "transport_type": 0,
      "destination_type": 0,
      "packet_type": 1
    },
    {
      "flags_byte": "02",
      "flags_binary": "00000010",
      "header_type": 0,
      "context_flag": 0,
      "transport_type": 0,
      "destination_type": 0,
      "packet_type": 2
    },
    {
      "flags_byte": "03",
      "flags_binary": "00000011",
      "header_type": 0,
      "context_flag": 0,
      "transport_type": 0,
      "destination_type": 0,
      "packet_type": 3
    },
    {
      "flags_byte": "04",
      "flags_binary": "00000100",
      "header_type": 0,
      "context_flag": 0,
      "transport_type": 0,
      "destination_type": 1,
      "packet_type": 0
    },
    {
      "flags_byte": "08",
      "flags_binary": "00001000",
      "header_type": 0,
      "context_flag": 0,
      "transport_type": 0,
      "destination_type": 2,
      "packet_type": 0
    },
    {
      "flags_byte": "0c",
      "flags_binary": "00001100",
      "header_type": 0,
      "context_flag": 0,
      "transport_type": 0,
      "destination_type": 3,
      "packet_type": 0
    },
    {
      "flags_byte": "10",
      "flags_binary": "00010000",
      "header_type": 0,
      "context_flag": 0,
      "transport_type": 1,
      "destination_type": 0,
      "packet_type": 0
    },
    {
      "flags_byte": "20",
      "flags_binary": "00100000",
      "header_type": 0,
      "context_flag": 1,
      "transport_type": 0,
      "destination_type": 0,
      "packet_type": 0
    },
    {
      "flags_byte": "40",
      "flags_binary": "01000000",
      "header_type": 1,
      "context_flag": 0,
      "transport_type": 0,
      "destination_type": 0,
      "packet_type": 0
    },
    {
      "flags_byte": "41",
      "flags_binary": "01000001",
      "header_type": 1,
      "context_flag": 0,
      "transport_type": 0,
      "destination_type": 0,
      "packet_type": 1
    },
    {
      "flags_byte": "51",
      "flags_binary": "01010001",
      "header_type": 1,
      "context_flag": 0,
      "transport_type": 1,
      "destination_type": 0,
      "packet_type": 1
    },
    {
      "flags_byte": "7f",
      "flags_binary": "01111111",
      "header_type": 1,
      "context_flag": 1,
      "transport_type": 1,
      "destination_type": 3,
      "packet_type": 3
    }
  ],
  "header_vectors": [
    {
      "description": "HEADER_1: DATA to SINGLE destination via BROADCAST",
      "header_type": "HEADER_1",
      "flags_byte": "00",
      "hops": 0,
      "destination_hash": "fb48da0e82e6e01ba0c014513f74540d",
      "context": "00",
      "header": "0000fb48da0e82e6e01ba0c014513f74540d00",
      "header_length": 19,
      "payload": "48656c6c6f2c205265746963756c756d21",
      "raw_packet": "0000fb48da0e82e6e01ba0c014513f74540d0048656c6c6f2c205265746963756c756d21",
      "hashable_part": "00fb48da0e82e6e01ba0c014513f74540d0048656c6c6f2c205265746963756c756d21",
      "hashable_part_note": "flags_masked(1 byte, raw[0] & 0x0F) + raw[2:]",
      "packet_hash_full": "37e98565752d1a30822391b994ed6a975024bd7ff4f3f94ed8961b14643e7370",
      "packet_hash": "37e98565752d1a30822391b994ed6a97",
      "expected_header_length": 19
    },
    {
      "description": "HEADER_1: ANNOUNCE to SINGLE destination via BROADCAST",
      "header_type": "HEADER_1",
      "flags_byte": "01",
      "hops": 0,
      "destination_hash": "fb48da0e82e6e01ba0c014513f74540d",
      "context": "00",
      "header": "0100fb48da0e82e6e01ba0c014513f74540d00",
      "header_length": 19,
      "payload": "48656c6c6f2c205265746963756c756d21",
      "raw_packet": "0100fb48da0e82e6e01ba0c014513f74540d0048656c6c6f2c205265746963756c756d21",
      "hashable_part": "01fb48da0e82e6e01ba0c014513f74540d0048656c6c6f2c205265746963756c756d21",
      "hashable_part_note": "flags_masked(1 byte, raw[0] & 0x0F) + raw[2:]",
      "packet_hash_full": "e3c925b171a7b66b3d76ba9fa9d6900fea8b013b0a2af525780d694329d6f413",
      "packet_hash": "e3c925b171a7b66b3d76ba9fa9d6900f",
      "expected_header_length": 19
    },
    {
      "description": "HEADER_1: LINKREQUEST to SINGLE destination via BROADCAST",
      "header_type": "HEADER_1",
      "flags_byte": "02",
      "hops": 0,
      "destination_hash": "fb48da0e82e6e01ba0c014513f74540d",
      "context": "00",
      "header": "0200fb48da0e82e6e01ba0c014513f74540d00",
      "header_length": 19,
      "payload": "48656c6c6f2c205265746963756c756d21",
      "raw_packet": "0200fb48da0e82e6e01ba0c014513f74540d0048656c6c6f2c205265746963756c756d21",
      "hashable_part": "02fb48da0e82e6e01ba0c014513f74540d0048656c6c6f2c205265746963756c756d21",
      "hashable_part_note": "flags_masked(1 byte, raw[0] & 0x0F) + raw[2:]",
      "packet_hash_full": "a933a69c6cd8c466391c3ececd24e1b0a5bf687be68e07fa43d8e91ed9bf50f0",
      "packet_hash": "a933a69c6cd8c466391c3ececd24e1b0",
      "expected_header_length": 19
    },
    {
      "description": "HEADER_2: DATA to SINGLE destination via TRANSPORT (3 hops)",
      "header_type": "HEADER_2",
      "flags_byte": "50",
      "hops": 3,
      "transport_id": "650b5d76b6bec0390d1f8cfca5bd33f9",
      "destination_hash": "fb48da0e82e6e01ba0c014513f74540d",
      "context": "00",
      "header": "5003650b5d76b6bec0390d1f8cfca5bd33f9fb48da0e82e6e01ba0c014513f74540d00",
      "header_length": 35,
      "payload": "48656c6c6f2c205265746963756c756d21",
      "raw_packet": "5003650b5d76b6bec0390d1f8cfca5bd33f9fb48da0e82e6e01ba0c014513f74540d0048656c6c6f2c205265746963756c756d21",
      "hashable_part": "00fb48da0e82e6e01ba0c014513f74540d0048656c6c6f2c205265746963756c756d21",
      "hashable_part_note": "flags_masked(1 byte, raw[0] & 0x0F) + raw[TRUNCATED_HASHLENGTH_BYTES + 2:] (skips transport_id)",
      "packet_hash_full": "37e98565752d1a30822391b994ed6a975024bd7ff4f3f94ed8961b14643e7370",
      "packet_hash": "37e98565752d1a30822391b994ed6a97",
      "expected_header_length": 35
    },
    {
      "description": "HEADER_2: ANNOUNCE to SINGLE destination via TRANSPORT (1 hop)",
      "header_type": "HEADER_2",
      "flags_byte": "51",
      "hops": 1,
      "transport_id": "650b5d76b6bec0390d1f8cfca5bd33f9",
      "destination_hash": "fb48da0e82e6e01ba0c014513f74540d",
      "context": "00",
      "header": "5101650b5d76b6bec0390d1f8cfca5bd33f9fb48da0e82e6e01ba0c014513f74540d00",
      "header_length": 35,
      "payload": "48656c6c6f2c205265746963756c756d21",
      "raw_packet": "5101650b5d76b6bec0390d1f8cfca5bd33f9fb48da0e82e6e01ba0c014513f74540d0048656c6c6f2c205265746963756c756d21",
      "hashable_part": "01fb48da0e82e6e01ba0c014513f74540d0048656c6c6f2c205265746963756c756d21",
      "hashable_part_note": "flags_masked(1 byte, raw[0] & 0x0F) + raw[TRUNCATED_HASHLENGTH_BYTES + 2:] (skips transport_id)",
      "packet_hash_full": "e3c925b171a7b66b3d76ba9fa9d6900fea8b013b0a2af525780d694329d6f413",
      "packet_hash": "e3c925b171a7b66b3d76ba9fa9d6900f",
      "expected_header_length": 35
    }
  ]
}
